<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Access control policies in Vault control what a user can access.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <title>Access Control Policies - Vault by HashiCorp</title>

    <link href="/assets/stylesheets/application-4b1f25b3.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-62fced3a.js" type="text/javascript"></script><script src="/assets/javascripts/respond.min-88c91176.js" type="text/javascript"></script><![endif]-->

    
  </head>

  <body id="page-Access Control Policies" class="page-Access Control Policies layout-intro page-sub">

<div id="header" class="navbar-static-top">
	<div class="container">
        <div class="row">
            <div class="col-md-offset-1 col-md-10 col-xs-12">
                <div class="navbar-header">
                    <div class="navbar-brand">
                         <a class="logo" href="">Vault</a>
                    </div>
                    <ul class="main-links nav navbar-nav navbar-right hidden-xs">
                        <li class="first li-under"><a href="intro/index.html">Intro</a></li>
                        <li class="li-under"><a href="docs/index.html">Docs</a></li>
                        <li class="li-under"><a href="community.html">Community</a></li>
                    </ul>
                    <button class="navbar-toggle" type="button">
                       <span class="sr-only">Toggle navigation</span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                    </button>                       
                </div>
                <div class="buttons hidden-xs">
            		<nav role="navigation">
            			<ul class="nav navbar-nav navbar-right">
            				<li class="first"><a href="downloads.html">Download</a></li>
            				<li class=""><a href="https://github.com/hashicorp/vault">GitHub</a></li>
            			</ul>
            		</nav>
                </div>
            </div>         
        </div>
    </div>
</div>


<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-2 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="intro/index.html">What is Vault?</a>
				</li>

				<li>
					<a href="intro/use-cases.html">Use Cases</a>
				</li>

				<li>
					<a href="intro/vs/index.html">Vault vs. Other Software</a>
					<ul class="nav">
						<li>
							<a href="intro/vs/chef-puppet-etc.html">Chef, Puppet, etc.</a>
						</li>

						<li>
							<a href="intro/vs/hsm.html">HSMs</a>
						</li>

						<li>
							<a href="intro/vs/dropbox.html">Dropbox</a>
                        </li>

						<li>
							<a href="intro/vs/consul.html">Consul</a>
                        </li>

						<li>
							<a href="intro/vs/kms.html">Amazon KMS</a>
                        </li>

						<li>
							<a href="intro/vs/keywhiz.html">Keywhiz</a>
						</li>

						<li>
							<a href="intro/vs/custom.html">Custom Solutions</a>
						</li>
					</ul>
				</li>

				<li class="active">
					<a href="intro/getting-started/install.html">Getting Started</a>
					<ul class="nav">
						<li>
							<a href="intro/getting-started/install.html">Install Vault</a>
						</li>

						<li>
							<a href="intro/getting-started/dev-server.html">Starting the Server</a>
						</li>

						<li>
							<a href="intro/getting-started/first-secret.html">Your First Secret</a>
						</li>

						<li>
							<a href="intro/getting-started/secret-backends.html">Secret Backends</a>
						</li>

						<li>
							<a href="intro/getting-started/dynamic-secrets.html">Dynamic Secrets</a>
						</li>

						<li>
							<a href="intro/getting-started/help.html">Built-in Help</a>
						</li>

						<li>
							<a href="intro/getting-started/authentication.html">Authentication</a>
						</li>

						<li class="active">
							<a href="intro/getting-started/acl.html">ACLs</a>
						</li>

						<li>
							<a href="intro/getting-started/deploy.html">Deploy Vault</a>
						</li>

						<li>
							<a href="intro/getting-started/next-steps.html">Next Steps</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-8 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Access Control Policies (ACLs)</h1>
<p>Access control policies in Vault control what a user can access. In
the last section, we learned about <em>authentication</em>. This section is
about <em>authorization</em>.</p>
<p>Whereas for authentication Vault has multiple options or backends that
can be enabled and used, the authorization or policies of Vault are always
the same format. All authentication backends must map identities back to
the core policies that are configured with Vault.</p>
<p>When initializing Vault, there is always one special policy created
that can&#39;t be removed: the &quot;root&quot; policy. This policy is a special policy
that gives superuser access to everything in Vault. An identity mapped to
the root policy can do anything.</p>

<h2>Policy Format</h2>
<p>Policies in Vault are formatted with
<a href="https://github.com/hashicorp/hcl">HCL</a>. HCL is a human-readable configuration
format that is also JSON-compatible, so you can use JSON as well. An example
policy is shown below:</p>
<pre class="highlight javascript"><code><span class="nx">path</span> <span class="s2">"sys"</span> <span class="p">{</span>
  <span class="nx">policy</span> <span class="o">=</span> <span class="s2">"deny"</span>
<span class="p">}</span>

<span class="nx">path</span> <span class="s2">"secret"</span> <span class="p">{</span>
  <span class="nx">policy</span> <span class="o">=</span> <span class="s2">"write"</span>
<span class="p">}</span>

<span class="nx">path</span> <span class="s2">"secret/foo"</span> <span class="p">{</span>
  <span class="nx">policy</span> <span class="o">=</span> <span class="s2">"read"</span>
<span class="p">}</span>
</code></pre>
<p>The policy format uses a longest matching prefix system on the API path
to determine access control. Since everything in Vault must be accessed
via the API, this gives strict control over every aspect of Vault, including
mounting backends, authenticating, as well as secret access.</p>
<p>In the policy above, a user could write any secret to <code>secret/</code>, except
to <code>secret/foo</code>, where only read access is allowed. Policies default to
deny, so any access to an unspecified path is not allowed.</p>
<p>Save the above policy as <code>acl.hcl</code>.</p>

<h2>Writing the Policy</h2>
<p>To write a policy, use the <code>vault policy-write</code> command:</p>
<pre class="highlight plaintext"><code>$ vault policy-write secret acl.hcl
Policy 'secret' written.
</code></pre>
<p>You can see the policies that are available with <code>vault policies</code>, and you
can see the contents of a policy with <code>vault policies &lt;name&gt;</code>. Only users with
root access can do this.</p>

<h2>Testing the Policy</h2>
<p>To use the policy, let&#39;s create a token and assign it to that policy.
Make sure to save your root token somewhere so you can authenticate
back to a root user later.</p>
<pre class="highlight plaintext"><code>$ vault token-create -policy="secret"
d97ef000-48cf-45d9-1907-3ea6ce298a29

$ vault auth d97ef000-48cf-45d9-1907-3ea6ce298a29
Successfully authenticated! The policies that are associated
with this token are listed below:

secret
</code></pre>
<p>You can now verify that you can write data to <code>secret/</code>, but only
read from <code>secret/foo</code>:</p>
<pre class="highlight plaintext"><code>$ vault write secret/bar value=yes
Success! Data written to: secret/bar

$ vault write secret/foo value=yes
Error writing data to secret/foo: Error making API request.

URL: PUT http://127.0.0.1:8200/v1/secret/foo
Code: 400. Errors:

* permission denied
</code></pre>
<p>You also don&#39;t have access to <code>sys</code> according to the policy, so commands
such as <code>vault mounts</code> will not work either.</p>

<h2>Mapping Policies to Auth Backends</h2>
<p>Vault is the single policy authority, unlike auth where you can mount
multiple backends. Any mounted auth backend must map identities to these
core policies.</p>
<p>Use the <code>vault help</code> system with your auth backend to determine how the
mapping is done, since it is specific to each backend. For example,
with GitHub, it is done by team using the <code>map/teams/&lt;team&gt;</code> path:</p>
<pre class="highlight plaintext"><code>$ vault write auth/github/map/teams/default value=secret
Success! Data written to: auth/github/map/teams/default
</code></pre>
<p>For GitHub, the &quot;default&quot; team is the default policy set that everyone
is assigned to no matter what team they&#39;re on.</p>
<p>Other auth backends use alternate, but likely similar mechanism for
mapping policies to identity.</p>

<h2>Next</h2>
<p>Policies are an important part of Vault. While using the root token
is easiest to get up and running, you&#39;ll want to restrict access to
Vault very quickly, and the policy system is the way to do this.</p>
<p>The syntax and function of policies is easy to understand and work
with, and because auth backends all must map to the central policy system,
you only have to learn this policy system.</p>
<p>Next, we&#39;ll cover how to <a href="/intro/getting-started/deploy.html">deploy Vault</a>.</p>


			</div>
		</div>
	</div>
</div>




<script type="text/x-handlebars" data-template-name="demo">
{{outlet}}
</script>

<script type="text/x-handlebars" data-template-name="demo/step">

<div class="instruction-wrapper">
    <div class="instruction">
        <p>
        <strong>{{model.humanName}}</strong>
        </p>

        {{partial model.instructionTemplate}}
    </div>
</div>

<span class="close-terminal" {{action "close"}}>X</span>

<div {{bind-attr class=":demo-terminal fullscreen:fullscreen" }}>
    <div class="log">{{renderedLogs}}</div>

    <form {{action "submitText" on="submit"}}>
        {{#unless isLoading}}${{/unless}} {{input value=currentText class="shell" spellcheck="false"}}
    </form>

    {{#if isLoading}}
    <div class="loading-bar"></div>
    {{/if}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="welcome">
    <p>
        This tutorial is great for getting familiar with the command line
         interface to Vault. As soon as you opened this terminal, you connected to a real in-memory Vault server.
        Any commands you enter will work as they would with Vault normally, but leaving this page
        will end the session.
    </p>
    <p>
     Please note that this is running in a shared environment, so avoid setting any real secrets.
    </p>
    <p>
        <strong>Use the command "next" to move forward</strong>.
    </p>
    <p>This will work throughout
        the tutorial, along with "previous" to go back a step.
    </p>
</script>


<script type="text/x-handlebars" data-template-name="steps">
    <p>
        This tutorial will cover the following steps:
    </p>
    <ul>
        <li>- Initializing and unsealing your Vault</li>
        <li>- Authorizing your requests to Vault</li>
        <li>- Reading and writing secrets</li>
        <li>- Sealing your Vault</li>
    </ul>
    <p>
        <strong>Again, use "next" to move to the first step – initializing your Vault</strong>.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="init">
    <p>
        To get started, we need to initialize an instance of Vault for you
        to work with.
    </p>
    <p>
        While initializing, you can configure the seal behavior
        of Vault.
        </p>
    <p>
        Initialize Vault now, with 1 unseal key for simplicity, using the command:
    </p>
    <p>
        <code>vault init -key-shares=1 -key-threshold=1</code>
    </p>
    <p>
        You'll notice Vault prints out several keys here. Don't clear your terminal,
        as these are needed in the next few steps.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="unseal">
    <p>
        When a Vault server is started, it starts in a sealed state.
         In this state, Vault is configured to know where and how to access the
         physical storage, but doesn't know how to decrypt any of it.
    </p>
    <p>
        Vault encrypts data with an encryption key. This key is encrypted with the "master key", which
        isn't stored. Decrypting the master key requires a threshold of shards. In this example,
        we use one shard to decrypt this master key.
    </p>
    <p>
        Unseal the Vault:
    </p>
    <p>
        <code>vault unseal &lt;key 1&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="auth">
    <p>
        Before performing any operation with Vault, the
        connecting client must be authenticated. Authentication is
        the process of verifying a person or machine is who they say
        they are and assigning an identity to them. This identity is then
        used when making requests with Vault.
    </p>
    <p>
        For simplicity, we'll use the root token we generated on init in Step 2. This
        output should be available in the scrollback.
    </p>
    <p>
        Authorize with a client token:
    </p>
    <p>
        <code>vault auth &lt;root token&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="secrets">
    <p>
        Now that Vault has been set-up, we can start reading and writing secrets
        with the default mounted secret backend. Secrets written to Vault
        are encrypted and then written to the backend storage.
        The backend storage mechanism never sees the unencrypted
        value and doesn't have the means necessary to decrypt
        it without Vault.
    </p>
    <p>
        <code>vault write secret/hello value=world</code>
    </p>
    <p>
        Of course, you can then read this data too:
    </p>
    <p>
        <code>vault read secret/hello</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="seal">
    <p>
        There is also an API to seal the Vault. This will throw
        away the encryption key and require another unseal process
        to restore it. Sealing only requires a single operator
        with root privileges. This is typically part of a rare "break glass
        procedure".
    </p>
    <p>
        This way, if there is a detected intrusion, the Vault data can be locked
        quickly to try to minimize damages. It can't be accessed again
        without access to the master key shards.
    </p>
    <p>
        <code>vault seal</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="finish">
    <p>
        Thanks for trying out the Vault CLI. If you want to keep playing with
        commands, use "fu" to go fullscreen.
    </p>
    <p>
        Note that the Vault CLI uses the HTTP API, which gives you full access to Vault. Every aspect
        of Vault can be controlled via this API.
    </p>
    <p>
        We recommend reading through the <a href="intro/index.html">intro guide</a> next, which will
        provide more background information, use cases and examples.
    </p>
</script>

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-5 col-sm-6 col-xs-12">
					<ul class="footer-links nav navbar-nav">
						<li class="li-under"><a href="intro/index.html">Intro</a></li>
						<li class="li-under"><a href="docs/index.html">Docs</a></li>
						<li class="li-under"><a href="community.html">Community</a></li>
						<li class="li-under"><a href="security.html">Security</a></li>
					</ul>
				</div>
				<div class="footer-hashi col-md-5 col-sm-6 col-xs-12">
					<div class="pull-right">
						<span>A <a href="https://www.hashicorp.com">HashiCorp</a> Project.</span>
						<a class="hashi-logo" href="https://www.hashicorp.com"><i class="hashi-logo"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62364009-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/javascripts/application-e782a4a8.js" type="text/javascript"></script>

</body>
</html>