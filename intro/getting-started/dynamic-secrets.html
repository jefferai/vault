<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="On this page we introduce dynamic secrets by showing you how to create AWS access keys with Vault.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <title>Dynamic Secrets - Vault by HashiCorp</title>

    <link href="/assets/stylesheets/application-4b1f25b3.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-62fced3a.js" type="text/javascript"></script><script src="/assets/javascripts/respond.min-88c91176.js" type="text/javascript"></script><![endif]-->

    
  </head>

  <body id="page-Dynamic Secrets" class="page-Dynamic Secrets layout-intro page-sub">

<div id="header" class="navbar-static-top">
	<div class="container">
        <div class="row">
            <div class="col-md-offset-1 col-md-10 col-xs-12">
                <div class="navbar-header">
                    <div class="navbar-brand">
                         <a class="logo" href="">Vault</a>
                    </div>
                    <ul class="main-links nav navbar-nav navbar-right hidden-xs">
                        <li class="first li-under"><a href="intro/index.html">Intro</a></li>
                        <li class="li-under"><a href="docs/index.html">Docs</a></li>
                        <li class="li-under"><a href="community.html">Community</a></li>
                    </ul>
                    <button class="navbar-toggle" type="button">
                       <span class="sr-only">Toggle navigation</span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                    </button>                       
                </div>
                <div class="buttons hidden-xs">
            		<nav role="navigation">
            			<ul class="nav navbar-nav navbar-right">
            				<li class="first"><a href="downloads.html">Download</a></li>
            				<li class=""><a href="https://github.com/hashicorp/vault">GitHub</a></li>
            			</ul>
            		</nav>
                </div>
            </div>         
        </div>
    </div>
</div>


<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-2 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="intro/index.html">What is Vault?</a>
				</li>

				<li>
					<a href="intro/use-cases.html">Use Cases</a>
				</li>

				<li>
					<a href="intro/vs/index.html">Vault vs. Other Software</a>
					<ul class="nav">
						<li>
							<a href="intro/vs/chef-puppet-etc.html">Chef, Puppet, etc.</a>
						</li>

						<li>
							<a href="intro/vs/hsm.html">HSMs</a>
						</li>

						<li>
							<a href="intro/vs/dropbox.html">Dropbox</a>
                        </li>

						<li>
							<a href="intro/vs/consul.html">Consul</a>
                        </li>

						<li>
							<a href="intro/vs/kms.html">Amazon KMS</a>
                        </li>

						<li>
							<a href="intro/vs/keywhiz.html">Keywhiz</a>
						</li>

						<li>
							<a href="intro/vs/custom.html">Custom Solutions</a>
						</li>
					</ul>
				</li>

				<li class="active">
					<a href="intro/getting-started/install.html">Getting Started</a>
					<ul class="nav">
						<li>
							<a href="intro/getting-started/install.html">Install Vault</a>
						</li>

						<li>
							<a href="intro/getting-started/dev-server.html">Starting the Server</a>
						</li>

						<li>
							<a href="intro/getting-started/first-secret.html">Your First Secret</a>
						</li>

						<li>
							<a href="intro/getting-started/secret-backends.html">Secret Backends</a>
						</li>

						<li class="active">
							<a href="intro/getting-started/dynamic-secrets.html">Dynamic Secrets</a>
						</li>

						<li>
							<a href="intro/getting-started/help.html">Built-in Help</a>
						</li>

						<li>
							<a href="intro/getting-started/authentication.html">Authentication</a>
						</li>

						<li>
							<a href="intro/getting-started/acl.html">ACLs</a>
						</li>

						<li>
							<a href="intro/getting-started/deploy.html">Deploy Vault</a>
						</li>

						<li>
							<a href="intro/getting-started/next-steps.html">Next Steps</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-8 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Dynamic Secrets</h1>
<p>Now that we&#39;ve written basic secrets to Vault and we have an understanding
of the mount system, we&#39;re going to move on to the next core feature of
Vault: <em>dynamic secrets</em>.</p>
<p>Dynamic secrets are secrets that are generated when they&#39;re accessed,
and aren&#39;t statically written like we did in
<a href="intro/getting-started/first-secret.html">Your First Secret</a>.
On this page, we&#39;ll use the built-in AWS secret backend to dynamically
generate AWS access keys.</p>
<p>The power of dynamic secrets is that they simply don&#39;t exist before
they&#39;re read, so there is no risk of someone stealing them or another
client using the same secrets. And because Vault has built-in revocation
mechanisms (covered later), the dynamic secret can be revoked right after
use, minimizing the amount of time the secret existed.</p>
<div class="alert alert-info" role="alert">
<p><strong>Note:</strong> Before starting this page, please register for an
<a href="http://aws.amazon.com">AWS account</a>. We won&#39;t be using any features that
cost money, so you shouldn&#39;t be charged for anything. However, we&#39;re not
responsible for any charges that may incur.</p>
</div>

<h2>Mounting the AWS Backend</h2>
<p>Let&#39;s generate our first dynamic secret. We&#39;ll use the AWS backend to
dynamically generate an AWS access key pair. First, mount the AWS backend:</p>
<pre class="highlight plaintext"><code>$ vault mount aws
Successfully mounted 'aws' at 'aws'!
</code></pre>
<p>The AWS backend is now mounted at <code>aws/</code>. As we covered in a previous
section: different secret backends allow for different behavior, and in this
case the AWS backend is a dynamic backend for generating AWS access credentials.</p>

<h2>Configuring the AWS Backend</h2>
<p>With the AWS backend mounted, the first step is to configure it with
the AWS credentials that will be used to create the other credentials.
For now, use the root keys for your AWS account.</p>
<p>To configure the backend, we use <code>vault write</code> to a special path
<code>aws/config/root</code>:</p>
<pre class="highlight plaintext"><code>$ vault write aws/config/root \
    access_key=AKIAI4SGLQPBX6CSENIQ \
    secret_key=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
Success! Data written to: aws/config/root
</code></pre>
<p>Remember that secret backends can behave anyway they want when
reading/writing a path, so this path stores this configuration for
later. Notice you can&#39;t read it back:</p>
<pre class="highlight plaintext"><code>$ vault read aws/config/root
Error reading aws/config/root: Error making API request.

URL: GET http://127.0.0.1:8200/v1/aws/config/root
Code: 500. Errors:

* unsupported operation
</code></pre>
<p>To help keep the credentials secure, the AWS backend doesn&#39;t let you
read them back even if you&#39;re using a root credential.</p>

<h2>Creating a Role</h2>
<p>The next step is to configure the AWS backend with an IAM policy.
IAM is the system AWS uses for creating new credentials with limited
API permissions.</p>
<p>The AWS backend requires an IAM policy to associate created credentials
with. For this example, we&#39;ll write just one policy, but you can associate
many policies with the backend. Save a file named &quot;policy.json&quot; with the following contents:</p>
<pre class="highlight javascript"><code><span class="p">{</span>
  <span class="s2">"Version"</span><span class="err">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="s2">"Statement"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"Sid"</span><span class="p">:</span> <span class="s2">"Stmt1426528957000"</span><span class="p">,</span>
      <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
      <span class="s2">"Action"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"ec2:*"</span>
      <span class="p">],</span>
      <span class="s2">"Resource"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"*"</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>
<p>This is a basic IAM policy that lets the user perform any action within
Amazon EC2. With the policy saved, write it to Vault and create a new role:</p>
<pre class="highlight plaintext"><code>$ vault write aws/roles/deploy policy=@policy.json
Success! Data written to: aws/roles/deploy
</code></pre>
<p>Again, we&#39;re using a special path here <code>aws/roles/&lt;NAME&gt;</code> to write
an IAM policy to Vault. We also used the special syntax <code>@filename</code> with
<code>vault write</code> to write the contents of a file.</p>

<h2>Generating the Secret</h2>
<p>Now that we&#39;ve configured the AWS backend and created a role, we can now
request an access key pair for that role. To do so, just read the
special path <code>aws/creds/&lt;NAME&gt;</code> where <code>NAME</code> is the role name:</p>
<pre class="highlight plaintext"><code>$ vault read aws/creds/deploy
Key         Value
lease_id    aws/creds/deploy/0d042c53-aa8a-7ce7-9dfd-310351c465e5
access_key  AKIAJFN42DVCQWDHQYHQ
secret_key  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
</code></pre>
<p>Success! The access and secret key can now be used to perform any EC2
operations within AWS. You can verify they work, if you want. Also notice
that these keys are new, they&#39;re not the keys you entered earlier.</p>
<p>The <code>lease_id</code> above is a special ID used for Vault for renewal,
revocation, etc. Copy and save your Lease ID now.</p>

<h2>Revoking the Secret</h2>
<p>Let&#39;s complete the loop and revoke this secret now, purging it from
existence. Once the secret is revoked, the access keys will no longer
work.</p>
<p>To revoke the secret, use <code>vault revoke</code> with the lease ID that was
outputted from <code>vault read</code> when you ran it:</p>
<pre class="highlight plaintext"><code>$ vault revoke aws/creds/deploy/0d042c53-aa8a-7ce7-9dfd-310351c465e5
Key revoked with ID 'aws/creds/deploy/0d042c53-aa8a-7ce7-9dfd-310351c465e5'.
</code></pre>
<p>Done! If you look at your AWS account, you&#39;ll notice that no IAM users
exist. If you try to use the access keys that were generated, you&#39;ll
find that they no longer work.</p>
<p>With such easy dynamic creation and revocation, you can hopefully begin
to see how easy it is to work with dynamic secrets and ensure they only
exist for the duration that they&#39;re needed.</p>

<h2>Next</h2>
<p>On this page we experienced our first dynamic secret, and we also saw
the revocation system in action. Dynamic secrets are incredibly powerful.
As time goes on, we expect that more systems will support some sort of
API to create access credentials, and Vault will be ready to get the
most value out of this practice.</p>
<p>Before going further, we&#39;re going to take a quick detour to learn
about the
<a href="intro/getting-started/help.html">built-in help system</a>.</p>


			</div>
		</div>
	</div>
</div>




<script type="text/x-handlebars" data-template-name="demo">
{{outlet}}
</script>

<script type="text/x-handlebars" data-template-name="demo/step">

<div class="instruction-wrapper">
    <div class="instruction">
        <p>
        <strong>{{model.humanName}}</strong>
        </p>

        {{partial model.instructionTemplate}}
    </div>
</div>

<span class="close-terminal" {{action "close"}}>X</span>

<div {{bind-attr class=":demo-terminal fullscreen:fullscreen" }}>
    <div class="log">{{renderedLogs}}</div>

    <form {{action "submitText" on="submit"}}>
        {{#unless isLoading}}${{/unless}} {{input value=currentText class="shell" spellcheck="false"}}
    </form>

    {{#if isLoading}}
    <div class="loading-bar"></div>
    {{/if}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="welcome">
    <p>
        This tutorial is great for getting familiar with the command line
         interface to Vault. As soon as you opened this terminal, you connected to a real in-memory Vault server.
        Any commands you enter will work as they would with Vault normally, but leaving this page
        will end the session.
    </p>
    <p>
     Please note that this is running in a shared environment, so avoid setting any real secrets.
    </p>
    <p>
        <strong>Use the command "next" to move forward</strong>.
    </p>
    <p>This will work throughout
        the tutorial, along with "previous" to go back a step.
    </p>
</script>


<script type="text/x-handlebars" data-template-name="steps">
    <p>
        This tutorial will cover the following steps:
    </p>
    <ul>
        <li>- Initializing and unsealing your Vault</li>
        <li>- Authorizing your requests to Vault</li>
        <li>- Reading and writing secrets</li>
        <li>- Sealing your Vault</li>
    </ul>
    <p>
        <strong>Again, use "next" to move to the first step – initializing your Vault</strong>.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="init">
    <p>
        To get started, we need to initialize an instance of Vault for you
        to work with.
    </p>
    <p>
        While initializing, you can configure the seal behavior
        of Vault.
        </p>
    <p>
        Initialize Vault now, with 1 unseal key for simplicity, using the command:
    </p>
    <p>
        <code>vault init -key-shares=1 -key-threshold=1</code>
    </p>
    <p>
        You'll notice Vault prints out several keys here. Don't clear your terminal,
        as these are needed in the next few steps.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="unseal">
    <p>
        When a Vault server is started, it starts in a sealed state.
         In this state, Vault is configured to know where and how to access the
         physical storage, but doesn't know how to decrypt any of it.
    </p>
    <p>
        Vault encrypts data with an encryption key. This key is encrypted with the "master key", which
        isn't stored. Decrypting the master key requires a threshold of shards. In this example,
        we use one shard to decrypt this master key.
    </p>
    <p>
        Unseal the Vault:
    </p>
    <p>
        <code>vault unseal &lt;key 1&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="auth">
    <p>
        Before performing any operation with Vault, the
        connecting client must be authenticated. Authentication is
        the process of verifying a person or machine is who they say
        they are and assigning an identity to them. This identity is then
        used when making requests with Vault.
    </p>
    <p>
        For simplicity, we'll use the root token we generated on init in Step 2. This
        output should be available in the scrollback.
    </p>
    <p>
        Authorize with a client token:
    </p>
    <p>
        <code>vault auth &lt;root token&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="secrets">
    <p>
        Now that Vault has been set-up, we can start reading and writing secrets
        with the default mounted secret backend. Secrets written to Vault
        are encrypted and then written to the backend storage.
        The backend storage mechanism never sees the unencrypted
        value and doesn't have the means necessary to decrypt
        it without Vault.
    </p>
    <p>
        <code>vault write secret/hello value=world</code>
    </p>
    <p>
        Of course, you can then read this data too:
    </p>
    <p>
        <code>vault read secret/hello</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="seal">
    <p>
        There is also an API to seal the Vault. This will throw
        away the encryption key and require another unseal process
        to restore it. Sealing only requires a single operator
        with root privileges. This is typically part of a rare "break glass
        procedure".
    </p>
    <p>
        This way, if there is a detected intrusion, the Vault data can be locked
        quickly to try to minimize damages. It can't be accessed again
        without access to the master key shards.
    </p>
    <p>
        <code>vault seal</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="finish">
    <p>
        Thanks for trying out the Vault CLI. If you want to keep playing with
        commands, use "fu" to go fullscreen.
    </p>
    <p>
        Note that the Vault CLI uses the HTTP API, which gives you full access to Vault. Every aspect
        of Vault can be controlled via this API.
    </p>
    <p>
        We recommend reading through the <a href="intro/index.html">intro guide</a> next, which will
        provide more background information, use cases and examples.
    </p>
</script>

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-5 col-sm-6 col-xs-12">
					<ul class="footer-links nav navbar-nav">
						<li class="li-under"><a href="intro/index.html">Intro</a></li>
						<li class="li-under"><a href="docs/index.html">Docs</a></li>
						<li class="li-under"><a href="community.html">Community</a></li>
						<li class="li-under"><a href="security.html">Security</a></li>
					</ul>
				</div>
				<div class="footer-hashi col-md-5 col-sm-6 col-xs-12">
					<div class="pull-right">
						<span>A <a href="https://www.hashicorp.com">HashiCorp</a> Project.</span>
						<a class="hashi-logo" href="https://www.hashicorp.com"><i class="hashi-logo"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62364009-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/javascripts/application-e782a4a8.js" type="text/javascript"></script>

</body>
</html>