<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The App ID auth backend is a mechanism for machines to authenticate with Vault.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <title>Auth Backend: App ID - Vault by HashiCorp</title>

    <link href="/assets/stylesheets/application-4b1f25b3.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-62fced3a.js" type="text/javascript"></script><script src="/assets/javascripts/respond.min-88c91176.js" type="text/javascript"></script><![endif]-->

    
  </head>

  <body id="page-Auth Backend: App ID" class="page-Auth Backend: App ID layout-docs page-sub">

<div id="header" class="navbar-static-top">
	<div class="container">
        <div class="row">
            <div class="col-md-offset-1 col-md-10 col-xs-12">
                <div class="navbar-header">
                    <div class="navbar-brand">
                         <a class="logo" href="/">Vault</a>
                    </div>
                    <ul class="main-links nav navbar-nav navbar-right hidden-xs">
                        <li class="first li-under"><a href="/intro/index.html">Intro</a></li>
                        <li class="li-under"><a href="/docs/index.html">Docs</a></li>
                        <li class="li-under"><a href="/community.html">Community</a></li>
                    </ul>
                    <button class="navbar-toggle" type="button">
                       <span class="sr-only">Toggle navigation</span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                    </button>                       
                </div>
                <div class="buttons hidden-xs">
            		<nav role="navigation">
            			<ul class="nav navbar-nav navbar-right">
            				<li class="first"><a href="/downloads.html">Download</a></li>
            				<li class=""><a href="https://github.com/hashicorp/vault">GitHub</a></li>
            			</ul>
            		</nav>
                </div>
            </div>         
        </div>
    </div>
</div>


<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-2 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="/docs/index.html">Documentation Home</a>
				</li>

				<li>
					<a href="/docs/internals/index.html">Internals</a>
					<ul class="nav">
						<li>
							<a href="/docs/internals/architecture.html">Architecture</a>
                        </li>

						<li>
							<a href="/docs/internals/high-availability.html">High Availability</a>
						</li>

						<li>
							<a href="/docs/internals/security.html">Security Model</a>
                        </li>

						<li>
							<a href="/docs/internals/telemetry.html">Telemetry</a>
                        </li>

						<li>
							<a href="/docs/internals/token.html">Token Authentication</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/install/index.html">Installation</a>
				</li>

				<li>
					<a href="/docs/concepts/index.html">Basic Concepts</a>
					<ul class="nav">
						<li>
							<a href="/docs/concepts/dev-server.html">"Dev" Server</a>
						</li>

						<li>
							<a href="/docs/concepts/seal.html">Seal/Unseal</a>
						</li>

						<li>
							<a href="/docs/concepts/lease.html">Lease, Renew, and Revoke</a>
						</li>

						<li>
							<a href="/docs/concepts/auth.html">Authentication</a>
						</li>

						<li>
							<a href="/docs/concepts/tokens.html">Tokens</a>
						</li>

						<li>
							<a href="/docs/concepts/policies.html">Access Control Policies</a>
						</li>

						<li>
							<a href="/docs/concepts/ha.html">High Availability</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/config/index.html">Configuration</a>
				</li>

				<li>
					<a href="/docs/commands/index.html">Commands (CLI)</a>
					<ul class="nav">
						<li>
							<a href="/docs/commands/help.html">Help</a>
						</li>

						<li>
							<a href="/docs/commands/read-write.html">Reading and Writing Data</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/http/index.html">HTTP API</a>
				</li>

				<hr>

				<li>
					<a href="/docs/secrets/index.html">Secret Backends</a>
					<ul class="nav">
						<li>
							<a href="/docs/secrets/aws/index.html">AWS</a>
						</li>

						<li>
							<a href="/docs/secrets/consul/index.html">Consul</a>
						</li>

						<li>
							<a href="/docs/secrets/pki/index.html">PKI (Certificates)</a>
                        </li>

						<li>
							<a href="/docs/secrets/postgresql/index.html">PostgreSQL</a>
                        </li>

						<li>
							<a href="/docs/secrets/mysql/index.html">MySQL</a>
						</li>

						<li>
							<a href="/docs/secrets/transit/index.html">Transit</a>
						</li>

						<li>
							<a href="/docs/secrets/generic/index.html">Generic</a>
						</li>

						<li>
							<a href="/docs/secrets/custom.html">Custom</a>
						</li>
					</ul>
				</li>

				<li class="active">
					<a href="/docs/auth/index.html">Auth Backends</a>
					<ul class="nav">
						<li>
                            <a href="/docs/auth/token.html">Tokens</a>
						</li>

						<li>
							<a href="/docs/auth/github.html">GitHub</a>
						</li>

						<li class="active">
							<a href="/docs/auth/app-id.html">App ID</a>
						</li>

						<li>
							<a href="/docs/auth/userpass.html">Username &amp; Password</a>
                        </li>

						<li>
							<a href="/docs/auth/cert.html">TLS Certificates</a>
                        </li>

						<li>
							<a href="/docs/auth/ldap.html">LDAP</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/audit/index.html">Audit Backends</a>
					<ul class="nav">
						<li>
							<a href="/docs/audit/file.html">File</a>
                        </li>

						<li>
							<a href="/docs/audit/syslog.html">Syslog</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-8 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Auth Backend: App ID</h1>
<p>Name: <code>app-id</code></p>
<p>The App ID auth backend is a mechanism for machines to authenticate with
Vault. It works by requiring two hard-to-guess unique pieces of information:
a unique app ID, and a unique user ID.</p>
<p>The goal of this credential provider is to allow elastic users
(dynamic machines, containers, etc.) to authenticate with Vault without
having to store passwords outside of Vault. It is a single method of
solving the chicken-and-egg problem of setting up Vault access on a machine.
With this provider, nobody except the machine itself has access to both
pieces of information necessary to authenticate. For example:
configuration management will have the app IDs, but the machine itself
will detect its user ID based on some unique machine property such as a
MAC address (or a hash of it with some salt).</p>
<p>An example, real world process for using this provider:</p>

<ol>
<li><p>Create unique app IDs (UUIDs work well) and map them to policies.
 (Path: map/app-id/<app-id>)</p>
</li>
<li><p>Store the app IDs within configuration management systems.</p>
</li>
<li><p>An out-of-band process run by security operators map unique user IDs
 to these app IDs. Example: when an instance is launched, a cloud-init
 system tells security operators a unique ID for this machine. This
 process can be scripted, but the key is that it is out-of-band and
 out of reach of configuration management.
(Path: map/user-id/<user-id>)</p>
</li>
<li><p>A new server is provisioned. Configuration management configures the
 app ID, the server itself detects its user ID. With both of these
 pieces of information, Vault can be accessed according to the policy
 set by the app ID.</p>
</li>
</ol>
<p>More details on this process follow:</p>
<p>The app ID is a unique ID that maps to a set of policies. This ID is
generated by an operator and configured into the backend. The ID itself
is usually a UUID, but any hard-to-guess unique value can be used.</p>
<p>After creating app IDs, an operator authorizes a fixed set of user IDs
with each app ID. When a valid {app ID, user ID} tuple is given to the
&quot;login&quot; path, then the user is authenticated with the configured app
ID policies.</p>
<p>The user ID can be any value (just like the app ID), however it is
generally a value unique to a machine, such as a MAC address or instance ID,
or a value hashed from these unique values.</p>

<h2>Authentication</h2>

<h4>Via the CLI</h4>
<p>App ID authentication is not allowed via the CLI.</p>

<h4>Via the API</h4>
<p>The endpoint for the App ID login is <code>/login</code>. The client is expected
to provide the <code>app_id</code> and <code>user_id</code> parameters as part of the request.</p>

<h2>Configuration</h2>
<p>First you must enable the App ID auth backend:</p>
<pre class="highlight plaintext"><code>$ vault auth-enable app-id
Successfully enabled 'app-id' at 'app-id'!
</code></pre>
<p>Now when you run <code>vault auth -methods</code>, the App ID backend is available:</p>
<pre class="highlight plaintext"><code>Path       Type      Description
app-id/    app-id
token/     token     token based credentials
</code></pre>
<p>To use the App ID auth backend, an operator must configure it with
the set of App IDs, user IDs, and the mapping between them. An
example is shown below, use <code>vault help</code> for more details.</p>
<pre class="highlight plaintext"><code>$ vault write auth/app-id/map/app-id/foo value=root display_name=foo
...

$ vault write auth/app-id/map/user-id/bar value=foo cidr_block=10.0.0.0/16
...
</code></pre>
<p>The above creates an App ID &quot;foo&quot; that associates with the policy &quot;root&quot;.
The <code>display_name</code> sets the display name for audit logs and secrets.
Next, we configure the user ID &quot;bar&quot; and say that the user ID bar
can be paired with &quot;foo&quot; but only in client is in the &quot;10.0.0.0/16&quot; CIDR block.
The <code>cidr_block</code> configuration is optional.</p>
<p>This means that if a client authenticates and provide both &quot;foo&quot; and &quot;bar&quot;,
then the app ID will authenticate that client with the policy &quot;root&quot;.</p>
<p>In practice, both the user and app ID are likely hard-to-guess UUID-like values.</p>


			</div>
		</div>
	</div>
</div>




<script type="text/x-handlebars" data-template-name="demo">
{{outlet}}
</script>

<script type="text/x-handlebars" data-template-name="demo/step">

<div class="instruction-wrapper">
    <div class="instruction">
        <p>
        <strong>{{model.humanName}}</strong>
        </p>

        {{partial model.instructionTemplate}}
    </div>
</div>

<span class="close-terminal" {{action "close"}}>X</span>

<div {{bind-attr class=":demo-terminal fullscreen:fullscreen" }}>
    <div class="log">{{renderedLogs}}</div>

    <form {{action "submitText" on="submit"}}>
        {{#unless isLoading}}${{/unless}} {{input value=currentText class="shell" spellcheck="false"}}
    </form>

    {{#if isLoading}}
    <div class="loading-bar"></div>
    {{/if}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="welcome">
    <p>
        This tutorial is great for getting familiar with the command line
         interface to Vault. As soon as you opened this terminal, you connected to a real in-memory Vault server.
        Any commands you enter will work as they would with Vault normally, but leaving this page
        will end the session.
    </p>
    <p>
     Please note that this is running in a shared environment, so avoid setting any real secrets.
    </p>
    <p>
        <strong>Use the command "next" to move forward</strong>.
    </p>
    <p>This will work throughout
        the tutorial, along with "previous" to go back a step.
    </p>
</script>


<script type="text/x-handlebars" data-template-name="steps">
    <p>
        This tutorial will cover the following steps:
    </p>
    <ul>
        <li>- Initializing and unsealing your Vault</li>
        <li>- Authorizing your requests to Vault</li>
        <li>- Reading and writing secrets</li>
        <li>- Sealing your Vault</li>
    </ul>
    <p>
        <strong>Again, use "next" to move to the first step – initializing your Vault</strong>.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="init">
    <p>
        To get started, we need to initialize an instance of Vault for you
        to work with.
    </p>
    <p>
        While initializing, you can configure the seal behavior
        of Vault.
        </p>
    <p>
        Initialize Vault now, with 1 unseal key for simplicity, using the command:
    </p>
    <p>
        <code>vault init -key-shares=1 -key-threshold=1</code>
    </p>
    <p>
        You'll notice Vault prints out several keys here. Don't clear your terminal,
        as these are needed in the next few steps.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="unseal">
    <p>
        When a Vault server is started, it starts in a sealed state.
         In this state, Vault is configured to know where and how to access the
         physical storage, but doesn't know how to decrypt any of it.
    </p>
    <p>
        Vault encrypts data with an encryption key. This key is encrypted with the "master key", which
        isn't stored. Decrypting the master key requires a threshold of shards. In this example,
        we use one shard to decrypt this master key.
    </p>
    <p>
        Unseal the Vault:
    </p>
    <p>
        <code>vault unseal &lt;key 1&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="auth">
    <p>
        Before performing any operation with Vault, the
        connecting client must be authenticated. Authentication is
        the process of verifying a person or machine is who they say
        they are and assigning an identity to them. This identity is then
        used when making requests with Vault.
    </p>
    <p>
        For simplicity, we'll use the root token we generated on init in Step 2. This
        output should be available in the scrollback.
    </p>
    <p>
        Authorize with a client token:
    </p>
    <p>
        <code>vault auth &lt;root token&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="secrets">
    <p>
        Now that Vault has been set-up, we can start reading and writing secrets
        with the default mounted secret backend. Secrets written to Vault
        are encrypted and then written to the backend storage.
        The backend storage mechanism never sees the unencrypted
        value and doesn't have the means necessary to decrypt
        it without Vault.
    </p>
    <p>
        <code>vault write secret/hello value=world</code>
    </p>
    <p>
        Of course, you can then read this data too:
    </p>
    <p>
        <code>vault read secret/hello</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="seal">
    <p>
        There is also an API to seal the Vault. This will throw
        away the encryption key and require another unseal process
        to restore it. Sealing only requires a single operator
        with root privileges. This is typically part of a rare "break glass
        procedure".
    </p>
    <p>
        This way, if there is a detected intrusion, the Vault data can be locked
        quickly to try to minimize damages. It can't be accessed again
        without access to the master key shards.
    </p>
    <p>
        <code>vault seal</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="finish">
    <p>
        Thanks for trying out the Vault CLI. If you want to keep playing with
        commands, use "fu" to go fullscreen.
    </p>
    <p>
        Note that the Vault CLI uses the HTTP API, which gives you full access to Vault. Every aspect
        of Vault can be controlled via this API.
    </p>
    <p>
        We recommend reading through the <a href="/intro/index.html">intro guide</a> next, which will
        provide more background information, use cases and examples.
    </p>
</script>

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-5 col-sm-6 col-xs-12">
					<ul class="footer-links nav navbar-nav">
						<li class="li-under"><a href="/intro/index.html">Intro</a></li>
						<li class="li-under"><a href="/docs/index.html">Docs</a></li>
						<li class="li-under"><a href="/community.html">Community</a></li>
						<li class="li-under"><a href="/security.html">Security</a></li>
					</ul>
				</div>
				<div class="footer-hashi col-md-5 col-sm-6 col-xs-12">
					<div class="pull-right">
						<span>A <a href="https://www.hashicorp.com">HashiCorp</a> Project.</span>
						<a class="hashi-logo" href="https://www.hashicorp.com"><i class="hashi-logo"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62364009-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/javascripts/application-e782a4a8.js" type="text/javascript"></script>

</body>
</html>