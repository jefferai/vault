<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The MySQL secret backend for Vault generates database credentials to access MySQL.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <title>Secret Backend: MySQL - Vault by HashiCorp</title>

    <link href="/assets/stylesheets/application-4b1f25b3.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-62fced3a.js" type="text/javascript"></script><script src="/assets/javascripts/respond.min-88c91176.js" type="text/javascript"></script><![endif]-->

    
  </head>

  <body id="page-Secret Backend: MySQL" class="page-Secret Backend: MySQL layout-docs page-sub">

<div id="header" class="navbar-static-top">
	<div class="container">
        <div class="row">
            <div class="col-md-offset-1 col-md-10 col-xs-12">
                <div class="navbar-header">
                    <div class="navbar-brand">
                         <a class="logo" href="/">Vault</a>
                    </div>
                    <ul class="main-links nav navbar-nav navbar-right hidden-xs">
                        <li class="first li-under"><a href="/intro/index.html">Intro</a></li>
                        <li class="li-under"><a href="/docs/index.html">Docs</a></li>
                        <li class="li-under"><a href="/community.html">Community</a></li>
                    </ul>
                    <button class="navbar-toggle" type="button">
                       <span class="sr-only">Toggle navigation</span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                    </button>                       
                </div>
                <div class="buttons hidden-xs">
            		<nav role="navigation">
            			<ul class="nav navbar-nav navbar-right">
            				<li class="first"><a href="/downloads.html">Download</a></li>
            				<li class=""><a href="https://github.com/hashicorp/vault">GitHub</a></li>
            			</ul>
            		</nav>
                </div>
            </div>         
        </div>
    </div>
</div>


<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-2 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="/docs/index.html">Documentation Home</a>
				</li>

				<li>
					<a href="/docs/internals/index.html">Internals</a>
					<ul class="nav">
						<li>
							<a href="/docs/internals/architecture.html">Architecture</a>
                        </li>

						<li>
							<a href="/docs/internals/high-availability.html">High Availability</a>
						</li>

						<li>
							<a href="/docs/internals/security.html">Security Model</a>
                        </li>

						<li>
							<a href="/docs/internals/telemetry.html">Telemetry</a>
                        </li>

						<li>
							<a href="/docs/internals/token.html">Token Authentication</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/install/index.html">Installation</a>
				</li>

				<li>
					<a href="/docs/concepts/index.html">Basic Concepts</a>
					<ul class="nav">
						<li>
							<a href="/docs/concepts/dev-server.html">"Dev" Server</a>
						</li>

						<li>
							<a href="/docs/concepts/seal.html">Seal/Unseal</a>
						</li>

						<li>
							<a href="/docs/concepts/lease.html">Lease, Renew, and Revoke</a>
						</li>

						<li>
							<a href="/docs/concepts/auth.html">Authentication</a>
						</li>

						<li>
							<a href="/docs/concepts/tokens.html">Tokens</a>
						</li>

						<li>
							<a href="/docs/concepts/policies.html">Access Control Policies</a>
						</li>

						<li>
							<a href="/docs/concepts/ha.html">High Availability</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/config/index.html">Configuration</a>
				</li>

				<li>
					<a href="/docs/commands/index.html">Commands (CLI)</a>
					<ul class="nav">
						<li>
							<a href="/docs/commands/help.html">Help</a>
						</li>

						<li>
							<a href="/docs/commands/read-write.html">Reading and Writing Data</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/http/index.html">HTTP API</a>
				</li>

				<hr>

				<li class="active">
					<a href="/docs/secrets/index.html">Secret Backends</a>
					<ul class="nav">
						<li>
							<a href="/docs/secrets/aws/index.html">AWS</a>
						</li>

						<li>
							<a href="/docs/secrets/consul/index.html">Consul</a>
						</li>

						<li>
							<a href="/docs/secrets/pki/index.html">PKI (Certificates)</a>
                        </li>

						<li>
							<a href="/docs/secrets/postgresql/index.html">PostgreSQL</a>
                        </li>

						<li class="active">
							<a href="/docs/secrets/mysql/index.html">MySQL</a>
						</li>

						<li>
							<a href="/docs/secrets/transit/index.html">Transit</a>
						</li>

						<li>
							<a href="/docs/secrets/generic/index.html">Generic</a>
						</li>

						<li>
							<a href="/docs/secrets/custom.html">Custom</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/auth/index.html">Auth Backends</a>
					<ul class="nav">
						<li>
                            <a href="/docs/auth/token.html">Tokens</a>
						</li>

						<li>
							<a href="/docs/auth/github.html">GitHub</a>
						</li>

						<li>
							<a href="/docs/auth/app-id.html">App ID</a>
						</li>

						<li>
							<a href="/docs/auth/userpass.html">Username &amp; Password</a>
                        </li>

						<li>
							<a href="/docs/auth/cert.html">TLS Certificates</a>
                        </li>

						<li>
							<a href="/docs/auth/ldap.html">LDAP</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="/docs/audit/index.html">Audit Backends</a>
					<ul class="nav">
						<li>
							<a href="/docs/audit/file.html">File</a>
                        </li>

						<li>
							<a href="/docs/audit/syslog.html">Syslog</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-8 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>MySQL Secret Backend</h1>
<p>Name: <code>mysql</code></p>
<p>The MySQL secret backend for Vault generates database credentials
dynamically based on configured roles. This means that services that need
to access a database no longer need to hardcode credentials: they can request
them from Vault, and use Vault&#39;s leasing mechanism to more easily roll keys.</p>
<p>Additionally, it introduces a new ability: with every service accessing
the database with unique credentials, it makes auditing much easier when
questionable data access is discovered: you can track it down to the specific
instance of a service based on the SQL username.</p>
<p>Vault makes use of its own internal revocation system to ensure that users
become invalid within a reasonable time of the lease expiring.</p>
<p>This page will show a quick start for this backend. For detailed documentation
on every path, use <code>vault help</code> after mounting the backend.</p>

<h2>Quick Start</h2>
<p>The first step to using the mysql backend is to mount it.
Unlike the <code>generic</code> backend, the <code>mysql</code> backend is not mounted by default.</p>
<pre class="highlight plaintext"><code>$ vault mount mysql
Successfully mounted 'mysql' at 'mysql'!
</code></pre>
<p>Next, we must configure Vault to know how to connect to the MySQL
instance. This is done by providing a DSN (Data Source Name):</p>
<pre class="highlight plaintext"><code>$ vault write mysql/config/connection value="root:root@tcp(192.168.33.10:3306)/"
Success! Data written to: mysql/config/connection
</code></pre>
<p>In this case, we&#39;ve configured Vault with the user &quot;root&quot; and password &quot;root,
connecting to an instance at &quot;192.168.33.10&quot; on port 3306. It is not necessary
that Vault has the root user, but the user must have privileges to create
other users, namely the <code>GRANT OPTION</code> privilege.</p>
<p>Optionally, we can configure the lease settings for credentials generated
by Vault. This is done by writing to the <code>config/lease</code> key:</p>
<pre class="highlight plaintext"><code>$ vault write mysql/config/lease lease=1h lease_max=24h
Success! Data written to: mysql/config/lease
</code></pre>
<p>This restricts each credential to being valid or leased for 1 hour
at a time, with a maximum use period of 24 hours. This forces an
application to renew their credentials at least hourly, and to recycle
them once per day.</p>
<p>The next step is to configure a role. A role is a logical name that maps
to a policy used to generated those credentials. For example, lets create
a &quot;readonly&quot; role:</p>
<pre class="highlight plaintext"><code>$ vault write mysql/roles/readonly sql="CREATE USER '{{name}}'@'%' IDENTIFIED BY '{{password}}';GRANT SELECT ON *.* TO '{{name}}'@'%';"
Success! Data written to: mysql/roles/readonly
</code></pre>
<p>By writing to the <code>roles/readonly</code> path we are defining the <code>readonly</code> role.
This role will be created by evaluating the given <code>sql</code> statements. By
default, the <code>{{name}}</code> and <code>{{password}}</code> fields will be populated by
Vault with dynamically generated values. This SQL statement is creating
the named user, and then granting it <code>SELECT</code> or read-only privileges
to tables in the database. More complex <code>GRANT</code> queries can be used to
customize the privileges of the role. See the <a href="https://dev.mysql.com/doc/refman/5.7/en/grant.html">MySQL manual</a>
for more information.</p>
<p>To generate a new set of credentials, we simply read from that role:</p>
<pre class="highlight plaintext"><code>$ vault read mysql/creds/readonly
Key             Value
lease_id        mysql/creds/readonly/bd404e98-0f35-b378-269a-b7770ef01897
lease_duration  3600
password        132ae3ef-5a64-7499-351e-bfe59f3a2a21
username        root-aefa635a-18
</code></pre>
<p>By reading from the <code>creds/readonly</code> path, Vault has generated a new
set of credentials using the <code>readonly</code> role configuration. Here we
see the dynamically generated username and password, along with a one
hour lease.</p>
<p>Using ACLs, it is possible to restrict using the mysql backend such
that trusted operators can manage the role definitions, and both
users and applications are restricted in the credentials they are
allowed to read.</p>

<h2>API</h2>

<h3>/mysql/config/connection</h3>

<h4>POST</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Configures the connection DSN used to communicate with MySQL.
This is a root protected endpoint.
</dd></p>
<p><dt>Method</dt>
<dd>POST</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/config/connection</code></dd></p>
<p><dt>Parameters</dt>
<dd>
<ul>
  <li>
    <span class="param">value</span>
    <span class="param-flags">required</span>
    The MySQL DSN
  </li>
</ul>
</dd></p>
<p><dt>Returns</dt>
<dd>
A <code>204</code> response code.
</dd></p>
</dl>
<h3>/mysql/config/lease</h3>

<h4>POST</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Configures the lease settings for generated credentials.
If not configured, leases default to 1 hour. This is a root
protected endpoint.
</dd></p>
<p><dt>Method</dt>
<dd>POST</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/config/lease</code></dd></p>
<p><dt>Parameters</dt>
<dd>
<ul>
  <li>
    <span class="param">lease</span>
    <span class="param-flags">required</span>
    The lease value provided as a string duration
    with time suffix. Hour is the largest suffix.
  </li>
  <li>
    <span class="param">lease_max</span>
    <span class="param-flags">required</span>
    The maximum lease value provided as a string duration
    with time suffix. Hour is the largest suffix.
  </li>
</ul>
</dd></p>
<p><dt>Returns</dt>
<dd>
A <code>204</code> response code.
</dd></p>
</dl>
<h3>/mysql/roles/</h3>

<h4>POST</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Creates or updates the role definition.
</dd></p>
<p><dt>Method</dt>
<dd>POST</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/roles/&lt;name&gt;</code></dd></p>
<p><dt>Parameters</dt>
<dd>
<ul>
  <li>
    <span class="param">sql</span>
    <span class="param-flags">required</span>
    The SQL statements executed to create and configure the role.
    Must be semi-colon separated. The &#39;{{name}}&#39; and &#39;{{password}}&#39;
    values will be substituted.
  </li>
</ul>
</dd></p>
<p><dt>Returns</dt>
<dd>
A <code>204</code> response code.
</dd></p>
</dl>
<h4>GET</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Queries the role definition.
</dd></p>
<p><dt>Method</dt>
<dd>GET</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/roles/&lt;name&gt;</code></dd></p>
<p><dt>Parameters</dt>
<dd>
 None
</dd></p>
<p><dt>Returns</dt>
<dd></p>
<pre class="highlight javascript"><code><span class="p">{</span>
    <span class="s2">"data"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"sql"</span><span class="err">:</span> <span class="s2">"CREATE USER..."</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p></dd></p>
</dl>
<h4>DELETE</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Deletes the role definition.
</dd></p>
<p><dt>Method</dt>
<dd>DELETE</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/roles/&lt;name&gt;</code></dd></p>
<p><dt>Parameters</dt>
<dd>
 None
</dd></p>
<p><dt>Returns</dt>
<dd>
A <code>204</code> response code.
</dd></p>
</dl>
<h3>/mysql/creds/</h3>

<h4>GET</h4>
<dl class="api">
<p><dt>Description</dt>
<dd>
Generates a new set of dynamic credentials based on the named role.
</dd></p>
<p><dt>Method</dt>
<dd>GET</dd></p>
<p><dt>URL</dt>
<dd><code>/mysql/creds/&lt;name&gt;</code></dd></p>
<p><dt>Parameters</dt>
<dd>
 None
</dd></p>
<p><dt>Returns</dt>
<dd></p>
<pre class="highlight javascript"><code><span class="p">{</span>
    <span class="s2">"data"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"username"</span><span class="err">:</span> <span class="s2">"root-aefa635a-18"</span><span class="p">,</span>
        <span class="s2">"password"</span><span class="err">:</span> <span class="s2">"132ae3ef-5a64-7499-351e-bfe59f3a2a21"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p></dd></p>
</dl>

			</div>
		</div>
	</div>
</div>




<script type="text/x-handlebars" data-template-name="demo">
{{outlet}}
</script>

<script type="text/x-handlebars" data-template-name="demo/step">

<div class="instruction-wrapper">
    <div class="instruction">
        <p>
        <strong>{{model.humanName}}</strong>
        </p>

        {{partial model.instructionTemplate}}
    </div>
</div>

<span class="close-terminal" {{action "close"}}>X</span>

<div {{bind-attr class=":demo-terminal fullscreen:fullscreen" }}>
    <div class="log">{{renderedLogs}}</div>

    <form {{action "submitText" on="submit"}}>
        {{#unless isLoading}}${{/unless}} {{input value=currentText class="shell" spellcheck="false"}}
    </form>

    {{#if isLoading}}
    <div class="loading-bar"></div>
    {{/if}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="welcome">
    <p>
        This tutorial is great for getting familiar with the command line
         interface to Vault. As soon as you opened this terminal, you connected to a real in-memory Vault server.
        Any commands you enter will work as they would with Vault normally, but leaving this page
        will end the session.
    </p>
    <p>
     Please note that this is running in a shared environment, so avoid setting any real secrets.
    </p>
    <p>
        <strong>Use the command "next" to move forward</strong>.
    </p>
    <p>This will work throughout
        the tutorial, along with "previous" to go back a step.
    </p>
</script>


<script type="text/x-handlebars" data-template-name="steps">
    <p>
        This tutorial will cover the following steps:
    </p>
    <ul>
        <li>- Initializing and unsealing your Vault</li>
        <li>- Authorizing your requests to Vault</li>
        <li>- Reading and writing secrets</li>
        <li>- Sealing your Vault</li>
    </ul>
    <p>
        <strong>Again, use "next" to move to the first step – initializing your Vault</strong>.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="init">
    <p>
        To get started, we need to initialize an instance of Vault for you
        to work with.
    </p>
    <p>
        While initializing, you can configure the seal behavior
        of Vault.
        </p>
    <p>
        Initialize Vault now, with 1 unseal key for simplicity, using the command:
    </p>
    <p>
        <code>vault init -key-shares=1 -key-threshold=1</code>
    </p>
    <p>
        You'll notice Vault prints out several keys here. Don't clear your terminal,
        as these are needed in the next few steps.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="unseal">
    <p>
        When a Vault server is started, it starts in a sealed state.
         In this state, Vault is configured to know where and how to access the
         physical storage, but doesn't know how to decrypt any of it.
    </p>
    <p>
        Vault encrypts data with an encryption key. This key is encrypted with the "master key", which
        isn't stored. Decrypting the master key requires a threshold of shards. In this example,
        we use one shard to decrypt this master key.
    </p>
    <p>
        Unseal the Vault:
    </p>
    <p>
        <code>vault unseal &lt;key 1&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="auth">
    <p>
        Before performing any operation with Vault, the
        connecting client must be authenticated. Authentication is
        the process of verifying a person or machine is who they say
        they are and assigning an identity to them. This identity is then
        used when making requests with Vault.
    </p>
    <p>
        For simplicity, we'll use the root token we generated on init in Step 2. This
        output should be available in the scrollback.
    </p>
    <p>
        Authorize with a client token:
    </p>
    <p>
        <code>vault auth &lt;root token&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="secrets">
    <p>
        Now that Vault has been set-up, we can start reading and writing secrets
        with the default mounted secret backend. Secrets written to Vault
        are encrypted and then written to the backend storage.
        The backend storage mechanism never sees the unencrypted
        value and doesn't have the means necessary to decrypt
        it without Vault.
    </p>
    <p>
        <code>vault write secret/hello value=world</code>
    </p>
    <p>
        Of course, you can then read this data too:
    </p>
    <p>
        <code>vault read secret/hello</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="seal">
    <p>
        There is also an API to seal the Vault. This will throw
        away the encryption key and require another unseal process
        to restore it. Sealing only requires a single operator
        with root privileges. This is typically part of a rare "break glass
        procedure".
    </p>
    <p>
        This way, if there is a detected intrusion, the Vault data can be locked
        quickly to try to minimize damages. It can't be accessed again
        without access to the master key shards.
    </p>
    <p>
        <code>vault seal</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="finish">
    <p>
        Thanks for trying out the Vault CLI. If you want to keep playing with
        commands, use "fu" to go fullscreen.
    </p>
    <p>
        Note that the Vault CLI uses the HTTP API, which gives you full access to Vault. Every aspect
        of Vault can be controlled via this API.
    </p>
    <p>
        We recommend reading through the <a href="/intro/index.html">intro guide</a> next, which will
        provide more background information, use cases and examples.
    </p>
</script>

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-5 col-sm-6 col-xs-12">
					<ul class="footer-links nav navbar-nav">
						<li class="li-under"><a href="/intro/index.html">Intro</a></li>
						<li class="li-under"><a href="/docs/index.html">Docs</a></li>
						<li class="li-under"><a href="/community.html">Community</a></li>
						<li class="li-under"><a href="/security.html">Security</a></li>
					</ul>
				</div>
				<div class="footer-hashi col-md-5 col-sm-6 col-xs-12">
					<div class="pull-right">
						<span>A <a href="https://www.hashicorp.com">HashiCorp</a> Project.</span>
						<a class="hashi-logo" href="https://www.hashicorp.com"><i class="hashi-logo"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62364009-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/javascripts/application-e782a4a8.js" type="text/javascript"></script>

</body>
</html>