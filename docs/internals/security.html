<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn about the security model of Vault.">

    <link rel="shortcut icon" href="/assets/images/favicon.png">

    <title>Security Model - Vault by HashiCorp</title>

    <link href="/assets/stylesheets/application-4b1f25b3.css" rel="stylesheet"/>

    <!--[if lt IE 9]><script src="/assets/javascripts/html5shiv-62fced3a.js" type="text/javascript"></script><script src="/assets/javascripts/respond.min-88c91176.js" type="text/javascript"></script><![endif]-->

    
  </head>

  <body id="page-Security Model" class="page-Security Model layout-docs page-sub">

<div id="header" class="navbar-static-top">
	<div class="container">
        <div class="row">
            <div class="col-md-offset-1 col-md-10 col-xs-12">
                <div class="navbar-header">
                    <div class="navbar-brand">
                         <a class="logo" href="">Vault</a>
                    </div>
                    <ul class="main-links nav navbar-nav navbar-right hidden-xs">
                        <li class="first li-under"><a href="intro/index.html">Intro</a></li>
                        <li class="li-under"><a href="docs/index.html">Docs</a></li>
                        <li class="li-under"><a href="community.html">Community</a></li>
                    </ul>
                    <button class="navbar-toggle" type="button">
                       <span class="sr-only">Toggle navigation</span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                       <span class="icon-bar"></span>
                    </button>                       
                </div>
                <div class="buttons hidden-xs">
            		<nav role="navigation">
            			<ul class="nav navbar-nav navbar-right">
            				<li class="first"><a href="downloads.html">Download</a></li>
            				<li class=""><a href="https://github.com/hashicorp/vault">GitHub</a></li>
            			</ul>
            		</nav>
                </div>
            </div>         
        </div>
    </div>
</div>


<div class="container">
	<div class="row">
		<div class="col-md-offset-1 col-md-2 col-sm-3 col-xs-12">
					<div class="docs-sidebar hidden-print affix-top" role="complementary">
			<ul class="nav docs-sidenav">
				<li>
					<a href="docs/index.html">Documentation Home</a>
				</li>

				<li class="active">
					<a href="docs/internals/index.html">Internals</a>
					<ul class="nav">
						<li>
							<a href="docs/internals/architecture.html">Architecture</a>
                        </li>

						<li>
							<a href="docs/internals/high-availability.html">High Availability</a>
						</li>

						<li class="active">
							<a href="docs/internals/security.html">Security Model</a>
                        </li>

						<li>
							<a href="docs/internals/telemetry.html">Telemetry</a>
                        </li>

						<li>
							<a href="docs/internals/token.html">Token Authentication</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="docs/install/index.html">Installation</a>
				</li>

				<li>
					<a href="docs/concepts/index.html">Basic Concepts</a>
					<ul class="nav">
						<li>
							<a href="docs/concepts/dev-server.html">"Dev" Server</a>
						</li>

						<li>
							<a href="docs/concepts/seal.html">Seal/Unseal</a>
						</li>

						<li>
							<a href="docs/concepts/lease.html">Lease, Renew, and Revoke</a>
						</li>

						<li>
							<a href="docs/concepts/auth.html">Authentication</a>
						</li>

						<li>
							<a href="docs/concepts/tokens.html">Tokens</a>
						</li>

						<li>
							<a href="docs/concepts/policies.html">Access Control Policies</a>
						</li>

						<li>
							<a href="docs/concepts/ha.html">High Availability</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="docs/config/index.html">Configuration</a>
				</li>

				<li>
					<a href="docs/commands/index.html">Commands (CLI)</a>
					<ul class="nav">
						<li>
							<a href="docs/commands/help.html">Help</a>
						</li>

						<li>
							<a href="docs/commands/read-write.html">Reading and Writing Data</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="docs/http/index.html">HTTP API</a>
				</li>

				<hr>

				<li>
					<a href="docs/secrets/index.html">Secret Backends</a>
					<ul class="nav">
						<li>
							<a href="docs/secrets/aws/index.html">AWS</a>
						</li>

						<li>
							<a href="docs/secrets/consul/index.html">Consul</a>
						</li>

						<li>
							<a href="docs/secrets/pki/index.html">PKI (Certificates)</a>
                        </li>

						<li>
							<a href="docs/secrets/postgresql/index.html">PostgreSQL</a>
                        </li>

						<li>
							<a href="docs/secrets/mysql/index.html">MySQL</a>
						</li>

						<li>
							<a href="docs/secrets/transit/index.html">Transit</a>
						</li>

						<li>
							<a href="docs/secrets/generic/index.html">Generic</a>
						</li>

						<li>
							<a href="docs/secrets/custom.html">Custom</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="docs/auth/index.html">Auth Backends</a>
					<ul class="nav">
						<li>
                            <a href="docs/auth/token.html">Tokens</a>
						</li>

						<li>
							<a href="docs/auth/github.html">GitHub</a>
						</li>

						<li>
							<a href="docs/auth/app-id.html">App ID</a>
						</li>

						<li>
							<a href="docs/auth/userpass.html">Username &amp; Password</a>
                        </li>

						<li>
							<a href="docs/auth/cert.html">TLS Certificates</a>
                        </li>

						<li>
							<a href="docs/auth/ldap.html">LDAP</a>
						</li>
					</ul>
				</li>

				<li>
					<a href="docs/audit/index.html">Audit Backends</a>
					<ul class="nav">
						<li>
							<a href="docs/audit/file.html">File</a>
                        </li>

						<li>
							<a href="docs/audit/syslog.html">Syslog</a>
						</li>
					</ul>
				</li>
			</ul>
		</div>

		</div>  
		<div id="main-content" class="col-sm-9 col-md-8 col-xs-12" role="main">
			<div class="bs-docs-section">
				
	<h1>Security Model</h1>
<p>Due to the nature of Vault and the confidentiality of data it is managing,
the Vault security model is very critical. The overall goal of Vault&#39;s security
model is to provide <a href="http://en.wikipedia.org/wiki/Information_security">confidentiality, integrity, availability, accountability,
authentication</a>.</p>
<p>This means that data at rest and in transit must be secure from eavesdropping
or tampering. Clients must be appropriately authenticated and authorized
to access data or modify policy. All interactions must be auditable and traced
uniquely back to the origin entity. The system must be robust against intentional
attempts to bypass any of its access controls.</p>

<h1>Threat Model</h1>
<p>The following are the various parts of the Vault threat model:</p>

<ul>
<li><p>Eavesdropping on any Vault communication. Client communication with Vault
should be secure from eavesdropping as well as communication from Vault to
its storage backend.</p>
</li>
<li><p>Tampering with data at rest or in transit. Any tampering should be detectable
and cause Vault to abort processing of the transaction.</p>
</li>
<li><p>Access to data or controls without authentication or authorization. All requests
must be proceeded by the applicable security policies.</p>
</li>
<li><p>Access to data or controls without accountability. If audit logging
is enabled, requests and responses must be logged before the client receives
any secret material.</p>
</li>
<li><p>Confidentiality of stored secrets. Any data that leaves Vault to rest in the
storage backend must be safe from eavesdropping. In practice, this means all
data at rest must be encrypted.</p>
</li>
<li><p>Availability of secret material in the face of failure. Vault supports
running in a highly available configuration to avoid loss of availability.</p>
</li>
</ul>
<p>The following are not parts of the Vault threat model:</p>

<ul>
<li><p>Protecting against arbitrary control of the storage backend. An attacker
that can perform arbitrary operations against the storage backend can
undermine in any number of ways that are difficult or impossible to protect
against. As an example, an attacker could delete or corrupt all the contents
of the storage backend causing total data loss for Vault. The ability to control
reads would allow an attacker to snapshot in a well-known state and rollback state
changes if that would be beneficial to them.</p>
</li>
<li><p>Protecting against the leakage of the existence of secret material. An attacker
that can read from the storage backend may observe that secret material exists
and is stored, even if it is kept confidential.</p>
</li>
<li><p>Protecting against memory analysis of a running Vault. If an attacker is able
to inspect the memory state of a running Vault instance then the confidentiality
of data may be compromised.</p>
</li>
</ul>

<h1>External Threat Overview</h1>
<p>Given the architecture of Vault, there are 3 distinct systems we are concerned with
for Vault. There is the client, which is speaking to Vault over an API. There is Vault
or the server more accurately, which is providing an API and serving requests. Lastly,
there is the storage backend, which the server is utilizing to read and write data.</p>
<p>There is no mutual trust between the Vault client and server. Clients use
<a href="http://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a> to verify the identity
of the server and to establish a secure communication channel. Servers require that
a client provides a client token for every request which is used to identify the client.
A client that does not provide their token is only permitted to make login requests.</p>
<p>The storage backends used by Vault are also untrusted by design. Vault uses a security
barrier for all requests made to the backend. The security barrier automatically encrypts
all data leaving Vault using the <a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>
cipher in the <a href="http://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois Counter Mode (GCM)</a>.
The nonce is randomly generated for every encrypted object. When data is read from the
security barrier the GCM authentication tag is verified prior to decryption to detect
any tampering.</p>
<p>Depending on the backend used, Vault may communicate with the backend over TLS
to provide an added layer of security. In some cases, such as a file backend this
is not applicable. Because storage backends are untrusted, an eavesdropper would
only gain access to encrypted data even if communication with the backend was intercepted.</p>

<h1>Internal Threat Overview</h1>
<p>Within the Vault system, a critical security concern is an attacker attempting
to gain access to secret material they are not authorized to. This is an internal
threat if the attacker is already permitted some level of access to Vault and is
able to authenticate.</p>
<p>When a client first authenticates with Vault, a credential backend is used to
verify the identity of the client and to return a list of associated ACL policies.
This association is configured by operators of Vault ahead of time. For example,
GitHub users in the &quot;engineering&quot; team may be mapped to the &quot;engineering&quot; and &quot;ops&quot;
Vault policies. Vault then generates a client token which is a randomly generated
UUID and maps it to the policy list. This client token is then returned to the client.</p>
<p>On each request a client provides this token. Vault then uses it to check that the token
is valid and has not been revoked or expired, and generates an ACL based on the associated
policies. Vault uses a strict default deny or whitelist enforcement. This means unless
an associated policy allows for a given action, it will be denied. Each policy specifies
a level of access granted to a path in Vault. When the policies are merged (if multiple
policies are associated with a client), the highest access level permitted is used.
For example, if the &quot;engineering&quot; policy permits read/write access to the &quot;eng/&quot; path,
and the &quot;ops&quot; policy permits read access to the &quot;ops/&quot; path, then the user gets the
union of those. Policy is matched using a longest-prefix match, which is the most
specific defined policy.</p>
<p>Certain operations are only permitted by &quot;root&quot; users, which is a distinguished
policy built into Vault. This is similar to the concept of a root user on a Unix system
or an Administrator on Windows. Although clients could be provided with root tokens
or associated with the root policy, instead Vault supports the notion of &quot;sudo&quot; privilege.
As part of a policy, users may be granted &quot;sudo&quot; privileges to certain paths, so that
they can still perform security sensitive operations without being granted global
root access to Vault.</p>
<p>Lastly, Vault supports using a <a href="http://en.wikipedia.org/wiki/Two-man_rule">Two-man rule</a> for
unsealing using <a href="http://en.wikipedia.org/wiki/Shamir's_Secret_Sharing">Shamir&#39;s Secret Sharing technique</a>.
When Vault is started, it starts in an <em>sealed</em> state. This means that the encryption key
needed to read and write from the storage backend is not yet known. The process of unsealing
requires providing the master key so that the encryption key can be retrieved. The risk of distributing
the master key is that a single malicious actor with access to it can decrypt the entire
Vault. Instead, Shamir&#39;s technique allows us to split the master key into multiple shares or parts.
The number of shares and the threshold needed is configurable, but by default Vault generates
5 shares, any 3 of which must be provided to reconstruct the master key.</p>
<p>By using a secret sharing technique, we avoid the need to place absolute trust in the holder
of the master key, and avoid storing the master key at all. The master key is only
retrievable by reconstructing the shares. The shares are not useful for making any requests
to Vault, and can only be used for unsealing. Once unsealed the standard ACL mechanisms
are used for all requests.</p>
<p>To make an analogy, a bank puts security deposit boxes inside of a vault.
Each security deposit box has a key, while the vault door has both a combination and a key.
The vault is encased in steel and concrete so that the door is the only practical entrance.
The analogy to Vault, is that the cryptosystem is the steel and concrete protecting the data.
While you could tunnel through the concrete or brute force the encryption keys, it would be
prohibitively time consuming. Opening the bank vault requires two-factors: the key and the combination.
Similarly, Vault requires multiple shares be provided to reconstruct the master key.
Once unsealed, each security deposit boxes still requires the owner provide a key, and similarly
the Vault ACL system protects all the secrets stored.</p>


			</div>
		</div>
	</div>
</div>




<script type="text/x-handlebars" data-template-name="demo">
{{outlet}}
</script>

<script type="text/x-handlebars" data-template-name="demo/step">

<div class="instruction-wrapper">
    <div class="instruction">
        <p>
        <strong>{{model.humanName}}</strong>
        </p>

        {{partial model.instructionTemplate}}
    </div>
</div>

<span class="close-terminal" {{action "close"}}>X</span>

<div {{bind-attr class=":demo-terminal fullscreen:fullscreen" }}>
    <div class="log">{{renderedLogs}}</div>

    <form {{action "submitText" on="submit"}}>
        {{#unless isLoading}}${{/unless}} {{input value=currentText class="shell" spellcheck="false"}}
    </form>

    {{#if isLoading}}
    <div class="loading-bar"></div>
    {{/if}}
</div>
</script>

<script type="text/x-handlebars" data-template-name="welcome">
    <p>
        This tutorial is great for getting familiar with the command line
         interface to Vault. As soon as you opened this terminal, you connected to a real in-memory Vault server.
        Any commands you enter will work as they would with Vault normally, but leaving this page
        will end the session.
    </p>
    <p>
     Please note that this is running in a shared environment, so avoid setting any real secrets.
    </p>
    <p>
        <strong>Use the command "next" to move forward</strong>.
    </p>
    <p>This will work throughout
        the tutorial, along with "previous" to go back a step.
    </p>
</script>


<script type="text/x-handlebars" data-template-name="steps">
    <p>
        This tutorial will cover the following steps:
    </p>
    <ul>
        <li>- Initializing and unsealing your Vault</li>
        <li>- Authorizing your requests to Vault</li>
        <li>- Reading and writing secrets</li>
        <li>- Sealing your Vault</li>
    </ul>
    <p>
        <strong>Again, use "next" to move to the first step â€“ initializing your Vault</strong>.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="init">
    <p>
        To get started, we need to initialize an instance of Vault for you
        to work with.
    </p>
    <p>
        While initializing, you can configure the seal behavior
        of Vault.
        </p>
    <p>
        Initialize Vault now, with 1 unseal key for simplicity, using the command:
    </p>
    <p>
        <code>vault init -key-shares=1 -key-threshold=1</code>
    </p>
    <p>
        You'll notice Vault prints out several keys here. Don't clear your terminal,
        as these are needed in the next few steps.
    </p>
</script>

<script type="text/x-handlebars" data-template-name="unseal">
    <p>
        When a Vault server is started, it starts in a sealed state.
         In this state, Vault is configured to know where and how to access the
         physical storage, but doesn't know how to decrypt any of it.
    </p>
    <p>
        Vault encrypts data with an encryption key. This key is encrypted with the "master key", which
        isn't stored. Decrypting the master key requires a threshold of shards. In this example,
        we use one shard to decrypt this master key.
    </p>
    <p>
        Unseal the Vault:
    </p>
    <p>
        <code>vault unseal &lt;key 1&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="auth">
    <p>
        Before performing any operation with Vault, the
        connecting client must be authenticated. Authentication is
        the process of verifying a person or machine is who they say
        they are and assigning an identity to them. This identity is then
        used when making requests with Vault.
    </p>
    <p>
        For simplicity, we'll use the root token we generated on init in Step 2. This
        output should be available in the scrollback.
    </p>
    <p>
        Authorize with a client token:
    </p>
    <p>
        <code>vault auth &lt;root token&gt;</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="secrets">
    <p>
        Now that Vault has been set-up, we can start reading and writing secrets
        with the default mounted secret backend. Secrets written to Vault
        are encrypted and then written to the backend storage.
        The backend storage mechanism never sees the unencrypted
        value and doesn't have the means necessary to decrypt
        it without Vault.
    </p>
    <p>
        <code>vault write secret/hello value=world</code>
    </p>
    <p>
        Of course, you can then read this data too:
    </p>
    <p>
        <code>vault read secret/hello</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="seal">
    <p>
        There is also an API to seal the Vault. This will throw
        away the encryption key and require another unseal process
        to restore it. Sealing only requires a single operator
        with root privileges. This is typically part of a rare "break glass
        procedure".
    </p>
    <p>
        This way, if there is a detected intrusion, the Vault data can be locked
        quickly to try to minimize damages. It can't be accessed again
        without access to the master key shards.
    </p>
    <p>
        <code>vault seal</code>
    </p>
</script>

<script type="text/x-handlebars" data-template-name="finish">
    <p>
        Thanks for trying out the Vault CLI. If you want to keep playing with
        commands, use "fu" to go fullscreen.
    </p>
    <p>
        Note that the Vault CLI uses the HTTP API, which gives you full access to Vault. Every aspect
        of Vault can be controlled via this API.
    </p>
    <p>
        We recommend reading through the <a href="intro/index.html">intro guide</a> next, which will
        provide more background information, use cases and examples.
    </p>
</script>

	<div id="footer">
		<div class="container">
			<div class="row">
				<div class="col-md-offset-1 col-md-5 col-sm-6 col-xs-12">
					<ul class="footer-links nav navbar-nav">
						<li class="li-under"><a href="intro/index.html">Intro</a></li>
						<li class="li-under"><a href="docs/index.html">Docs</a></li>
						<li class="li-under"><a href="community.html">Community</a></li>
						<li class="li-under"><a href="security.html">Security</a></li>
					</ul>
				</div>
				<div class="footer-hashi col-md-5 col-sm-6 col-xs-12">
					<div class="pull-right">
						<span>A <a href="https://www.hashicorp.com">HashiCorp</a> Project.</span>
						<a class="hashi-logo" href="https://www.hashicorp.com"><i class="hashi-logo"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62364009-1', 'auto');
  ga('send', 'pageview');
</script>

<script src="/assets/javascripts/application-e782a4a8.js" type="text/javascript"></script>

</body>
</html>